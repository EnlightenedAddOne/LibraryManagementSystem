var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,d=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,i=(e,l,a)=>new Promise(((s,o)=>{var r=e=>{try{i(a.next(e))}catch(l){o(l)}},d=e=>{try{i(a.throw(e))}catch(l){o(l)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(r,d);i((a=a.apply(e,l)).next())}));import{b as u,_ as t}from"./index-D1Hg0Vwf.js";/* empty css               *//* empty css                   */import{k as n,c as p,r as m,a2 as c,e as b,D as v,m as f,t as g,z as h,u as w,G as y,x as V,y as U,aJ as _,a4 as x,L as k,ad as P,I as N,J as j,ae as I,O,S as R,P as q,T as L,a3 as D,E}from"./vendor-CJD3O2Jl.js";const S={class:"page-content user"},C={class:"content"},J={class:"left-wrap"},z={class:"user-wrap box-style"},A=["src"],F=["src"],G={class:"name"},H={class:"des"},M={class:"outer-info"},T={class:"right-wrap"},B={class:"info box-style"},K={class:"el-form-item-right"},Q={class:"info box-style",style:{"margin-top":"20px"}},W={class:"el-form-item-right"},X=n((Y=((e,l)=>{for(var a in l||(l={}))o.call(l,a)&&d(e,a,l[a]);if(s)for(var a of s(l))r.call(l,a)&&d(e,a,l[a]);return e})({},{name:"UserCenter"}),l(Y,a({__name:"index",setup(e){var l,a,s,o,r,d,t,n,X;const Y=u(),Z=p((()=>Y.getUserInfo)),$=m(!1),ee=m(!1),le=m(""),ae=c({realName:(null==(l=Z.value.profile)?void 0:l.realName)||"",nikeName:(null==(a=Z.value.profile)?void 0:a.nickname)||"",email:(null==(s=Z.value.profile)?void 0:s.email)||"",mobile:(null==(o=Z.value.profile)?void 0:o.phone)||"",school:(null==(r=Z.value.profile)?void 0:r.school)||"",sex:(null==(d=Z.value.profile)?void 0:d.sex)||"0",avatar:(null==(t=Z.value.profile)?void 0:t.avatar)||"",backgroundUrl:(null==(n=Z.value.profile)?void 0:n.backgroundUrl)||"",des:(null==(X=Z.value.profile)?void 0:X.description)||"暂无介绍"}),se=c({password:"123456",newPassword:"123456",confirmPassword:"123456"}),oe=m(),re=c({realName:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 30 个字符",trigger:"blur"}],nikeName:[{required:!0,message:"请输入昵称",trigger:"blur"},{min:2,max:50,message:"长度在 2 到 30 个字符",trigger:"blur"}],email:[{required:!0,message:"请输入昵称",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号码",trigger:"blur"}],school:[{required:!0,message:"请输入学校",trigger:"blur"}],sex:[{required:!0,message:"请选择性别",trigger:"blur"}]}),de=[{value:"1",label:"男"},{value:"0",label:"女"}],ie={R_SUPER:"超级管理员",R_ADMIN:"管理员",R_USER:"普通用户"};b((()=>{ue()}));const ue=()=>{const e=(new Date).getHours();let l="";e>=6&&e<9?l="早上好":e>=9&&e<11?l="上午好":e>=11&&e<13?l="中午好":e>=13&&e<18?l="下午好":e>=18&&e<24?l="晚上好":e>=0&&e<6&&(l="很晚了，早点睡"),le.value=l};b((()=>i(this,null,(function*(){yield Y.fetchUserInfo()}))));const te=()=>i(this,null,(function*(){var e;if($.value)try{yield null==(e=oe.value)?void 0:e.validate();const l={username:Z.value.username,role:Z.value.role,profile:{realName:ae.realName,nickname:ae.nikeName,email:ae.email,phone:ae.mobile,school:ae.school,sex:ae.sex,description:ae.des,avatar:ae.avatar||"",backgroundUrl:ae.backgroundUrl||""}},a=yield Y.updateUserInfo({userId:Z.value.userId,data:l});200===a.code?(E.success("更新成功"),$.value=!1,yield Y.fetchUserInfo()):E.error(a.message||"更新失败")}catch(l){E.error("表单验证失败")}else $.value=!0})),ne=()=>{ee.value=!ee.value};return(e,l)=>{var a,s,o,r,d,i,u;const t=k,n=x,p=I,m=P,c=_,b=k,E=q,X=v("ripple");return g(),f("div",S,[h("div",C,[h("div",J,[h("div",z,[h("img",{class:"bg",src:(null==(a=w(Z).profile)?void 0:a.backgroundUrl)||"@imgs/user/bg.webp"},null,8,A),h("img",{class:"avatar",src:null==(s=w(Z).profile)?void 0:s.avatar},null,8,F),h("h2",G,y(null==(o=w(Z).profile)?void 0:o.nickname),1),h("p",H,y((null==(r=w(Z).profile)?void 0:r.description)||"暂无介绍"),1),h("div",M,[h("div",null,[l[12]||(l[12]=h("i",{class:"iconfont-sys"},"",-1)),h("span",null,y(null==(d=w(Z).profile)?void 0:d.email),1)]),h("div",null,[l[13]||(l[13]=h("i",{class:"iconfont-sys"},"",-1)),h("span",null,y(null==(i=w(Z).profile)?void 0:i.realName),1)]),h("div",null,[l[14]||(l[14]=h("i",{class:"iconfont-sys"},"",-1)),h("span",null,y(null==(u=w(Z).profile)?void 0:u.school),1)]),h("div",null,[l[15]||(l[15]=h("i",{class:"iconfont-sys"},"",-1)),h("span",null,y(ie[w(Z).role]),1)])])])]),h("div",T,[h("div",B,[l[16]||(l[16]=h("h1",{class:"title"},"基本设置",-1)),V(w(D),{model:w(ae),class:"form",ref_key:"ruleFormRef",ref:oe,rules:w(re),"label-width":"86px","label-position":"top"},{default:U((()=>[V(c,null,{default:U((()=>[V(n,{label:"姓名",prop:"realName"},{default:U((()=>[V(t,{modelValue:w(ae).realName,"onUpdate:modelValue":l[0]||(l[0]=e=>w(ae).realName=e),disabled:!w($)},null,8,["modelValue","disabled"])])),_:1}),V(n,{label:"性别",prop:"sex",class:"right-input"},{default:U((()=>[V(m,{modelValue:w(ae).sex,"onUpdate:modelValue":l[1]||(l[1]=e=>w(ae).sex=e),placeholder:"请选择性别",disabled:!w($)},{default:U((()=>[(g(),f(N,null,j(de,(e=>V(p,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),64))])),_:1},8,["modelValue","disabled"])])),_:1})])),_:1}),V(c,null,{default:U((()=>[V(n,{label:"昵称",prop:"nikeName"},{default:U((()=>[V(b,{modelValue:w(ae).nikeName,"onUpdate:modelValue":l[2]||(l[2]=e=>w(ae).nikeName=e),disabled:!w($)},null,8,["modelValue","disabled"])])),_:1}),V(n,{label:"邮箱",prop:"email",class:"right-input"},{default:U((()=>[V(b,{modelValue:w(ae).email,"onUpdate:modelValue":l[3]||(l[3]=e=>w(ae).email=e),disabled:!w($)},null,8,["modelValue","disabled"])])),_:1})])),_:1}),V(c,null,{default:U((()=>[V(n,{label:"头像URL",prop:"avatar"},{default:U((()=>[V(b,{modelValue:w(ae).avatar,"onUpdate:modelValue":l[4]||(l[4]=e=>w(ae).avatar=e),disabled:!w($),placeholder:"请输入头像图片URL"},null,8,["modelValue","disabled"])])),_:1}),V(n,{label:"背景URL",prop:"backgroundUrl",class:"right-input"},{default:U((()=>[V(b,{modelValue:w(ae).backgroundUrl,"onUpdate:modelValue":l[5]||(l[5]=e=>w(ae).backgroundUrl=e),disabled:!w($),placeholder:"请输入背景图片URL"},null,8,["modelValue","disabled"])])),_:1})])),_:1}),V(c,null,{default:U((()=>[V(n,{label:"手机",prop:"mobile"},{default:U((()=>[V(b,{modelValue:w(ae).mobile,"onUpdate:modelValue":l[6]||(l[6]=e=>w(ae).mobile=e),disabled:!w($)},null,8,["modelValue","disabled"])])),_:1}),V(n,{label:"学校",prop:"school",class:"right-input"},{default:U((()=>[V(b,{modelValue:w(ae).school,"onUpdate:modelValue":l[7]||(l[7]=e=>w(ae).school=e),disabled:!w($)},null,8,["modelValue","disabled"])])),_:1})])),_:1}),V(n,{label:"个人介绍",prop:"des",style:{height:"130px"}},{default:U((()=>[V(b,{type:"textarea",rows:4,modelValue:w(ae).des,"onUpdate:modelValue":l[8]||(l[8]=e=>w(ae).des=e),disabled:!w($)},null,8,["modelValue","disabled"])])),_:1}),h("div",K,[O((g(),R(E,{type:"primary",style:{width:"90px"},onClick:te},{default:U((()=>[L(y(w($)?"保存":"编辑"),1)])),_:1})),[[X]])])])),_:1},8,["model","rules"])]),h("div",Q,[l[17]||(l[17]=h("h1",{class:"title"},"更改密码",-1)),V(w(D),{model:w(se),class:"form","label-width":"86px","label-position":"top"},{default:U((()=>[V(n,{label:"当前密码",prop:"password"},{default:U((()=>[V(b,{modelValue:w(se).password,"onUpdate:modelValue":l[9]||(l[9]=e=>w(se).password=e),type:"password",disabled:!w(ee),"show-password":""},null,8,["modelValue","disabled"])])),_:1}),V(n,{label:"新密码",prop:"newPassword"},{default:U((()=>[V(b,{modelValue:w(se).newPassword,"onUpdate:modelValue":l[10]||(l[10]=e=>w(se).newPassword=e),type:"password",disabled:!w(ee)},null,8,["modelValue","disabled"])])),_:1}),V(n,{label:"确认新密码",prop:"confirmPassword"},{default:U((()=>[V(b,{modelValue:w(se).confirmPassword,"onUpdate:modelValue":l[11]||(l[11]=e=>w(se).confirmPassword=e),type:"password",disabled:!w(ee)},null,8,["modelValue","disabled"])])),_:1}),h("div",W,[O((g(),R(E,{type:"primary",style:{width:"90px"},onClick:ne},{default:U((()=>[L(y(w(ee)?"保存":"编辑"),1)])),_:1})),[[X]])])])),_:1},8,["model"])])])])])}}}))));var Y;const Z=t(X,[["__scopeId","data-v-fddb4e22"]]);export{Z as default};
