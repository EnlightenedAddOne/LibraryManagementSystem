var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,d=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))r.call(a,l)&&d(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&d(e,l,a[l]);return e};import{D as s,F as u,_ as i}from"./index-Co7Jc6td.js";/* empty css                    */import{_ as c}from"./ArtTable-DOVWYSlp.js";/* empty css                        *//* empty css               *//* empty css               */import{R as m}from"./formData-DjnVdGbe.js";import{k as p,r as f,s as _,c as h,a2 as b,e as v,D as g,m as y,t as k,x,y as C,z as w,aI as j,L as V,O as N,S as O,P,T as L,aJ as U,aN as D,aZ as E,G as K,u as R,a3 as S,a4 as T,ab as $,i as A,a6 as I,a9 as q,bb as z,aw as B,E as F}from"./vendor-CJD3O2Jl.js";/* empty css                   *//* empty css                      *//* empty css                 */import"./formEnum-BLgiZVxV.js";const G={class:"page-content"},J={class:"dialog-footer"},M={style:{display:"flex","align-items":"center"}},W={key:0},Z={key:1},H={class:"dialog-footer"};var Q;const X=i(p((Q=n({},{name:"Role"}),a(Q,l({__name:"index",setup(e){const a=f(!1),l=f(!1),{menuList:t}=_(s()),r=f(),o=f(!0),d=f(!1),i=h((()=>{const e=a=>{const l=n({},a);if(a.meta&&a.meta.authList&&a.meta.authList.length){const e=a.meta.authList.map((e=>({id:`${a.id}_${e.auth_mark}`,name:`${a.name}_${e.auth_mark}`,label:e.title,auth_mark:e.auth_mark,isAuth:!0,checked:e.checked||!1})));l.children=l.children?[...l.children,...e]:e}return l.children&&(l.children=l.children.map(e)),l};return t.value.map(e)})),p=f(),Q=b({name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"长度在 2 到 20 个字符",trigger:"blur"}],des:[{required:!0,message:"请输入角色描述",trigger:"blur"}]}),X=b({roleName:"",roleCode:"",des:"",date:"",enable:!0}),Y=f([]);v((()=>{ee()}));const ee=()=>{Y.value=m},ae=f("add"),le=(e,l)=>{a.value=!0,ae.value=e,"edit"===e&&l?(X.roleName=l.roleName,X.roleCode=l.roleCode,X.des=l.des,X.date=l.date,X.enable=l.enable):(X.roleName="",X.roleCode="",X.des="",X.date="",X.enable=!0)},te={children:"children",label:e=>{var a;return u(null==(a=e.meta)?void 0:a.title)||""}},re=e=>{return l=this,t=null,r=function*(){e&&(yield e.validate((l=>{if(l){const l="add"===ae.value?"新增成功":"修改成功";F.success(l),a.value=!1,e.resetFields()}})))},new Promise(((e,a)=>{var o=e=>{try{n(r.next(e))}catch(l){a(l)}},d=e=>{try{n(r.throw(e))}catch(l){a(l)}},n=a=>a.done?e(a.value):Promise.resolve(a.value).then(o,d);n((r=r.apply(l,t)).next())}));var l,t,r},oe=()=>{F.success("权限保存成功"),l.value=!1},de=()=>{const e=r.value;if(!e)return;const a=e.store.nodesMap;for(const l in a)a[l].expanded=!o.value;o.value=!o.value},ne=()=>{const e=r.value;if(e){if(d.value)e.setCheckedKeys([]);else{const a=se(i.value);e.setCheckedKeys(a)}d.value=!d.value}},se=e=>{const a=[],l=e=>{e.forEach((e=>{e.name&&a.push(e.name),e.children&&e.children.length>0&&l(e.children)}))};return l(e),a},ue=()=>{const e=r.value;if(!e)return;const a=e.getCheckedKeys(),l=se(i.value);d.value=a.length===l.length&&l.length>0};return(e,t)=>{const n=V,s=j,u=P,m=U,f=D,_=E,h=P,b=c,v=T,ee=$,se=S,ie=I,ce=z,me=q,pe=g("ripple");return k(),y("div",G,[x(m,null,{default:C((()=>[x(s,{xs:24,sm:12,lg:6},{default:C((()=>[x(n,{placeholder:"部门名称"})])),_:1}),t[13]||(t[13]=w("div",{style:{width:"12px"}},null,-1)),x(s,{xs:24,sm:12,lg:6,class:"el-col2"},{default:C((()=>[N((k(),O(u,null,{default:C((()=>t[11]||(t[11]=[L("搜索")]))),_:1,__:[11]})),[[pe]]),N((k(),O(u,{onClick:t[0]||(t[0]=e=>le("add"))},{default:C((()=>t[12]||(t[12]=[L("新增角色")]))),_:1,__:[12]})),[[pe]])])),_:1})])),_:1,__:[13]}),x(b,{data:R(Y),index:""},{default:C((()=>[x(f,{label:"角色名称",prop:"roleName"}),x(f,{label:"角色编码",prop:"roleCode"}),x(f,{label:"描述",prop:"des"}),x(f,{label:"启用",prop:"enable"},{default:C((e=>[x(_,{type:e.row.enable?"primary":"info"},{default:C((()=>[L(K(e.row.enable?"启用":"禁用"),1)])),_:2},1032,["type"])])),_:1}),x(f,{label:"创建时间",prop:"date"},{default:C((e=>{return[L(K((a=e.row.date,new Date(a).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/\//g,"-"))),1)];var a})),_:1}),x(f,{fixed:"right",label:"操作",width:"200px"},{default:C((e=>[x(m,null,{default:C((()=>[x(h,{link:"",onClick:t[1]||(t[1]=e=>{l.value=!0})},{default:C((()=>t[14]||(t[14]=[L(" 菜单权限 ")]))),_:1,__:[14]}),x(h,{link:"",onClick:a=>le("edit",e.row)},{default:C((()=>t[15]||(t[15]=[L(" 编辑 ")]))),_:2,__:[15]},1032,["onClick"]),x(h,{link:"",onClick:t[2]||(t[2]=e=>{B.confirm("确定删除该角色吗？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"error"}).then((()=>{F.success("删除成功")}))})},{default:C((()=>t[16]||(t[16]=[L(" 删除 ")]))),_:1,__:[16]})])),_:2},1024)])),_:1})])),_:1},8,["data"]),x(ie,{modelValue:R(a),"onUpdate:modelValue":t[9]||(t[9]=e=>A(a)?a.value=e:null),title:"add"===R(ae)?"新增角色":"编辑角色",width:"30%","align-center":""},{footer:C((()=>[w("div",J,[x(u,{onClick:t[7]||(t[7]=e=>a.value=!1)},{default:C((()=>t[17]||(t[17]=[L("取消")]))),_:1,__:[17]}),x(u,{type:"primary",onClick:t[8]||(t[8]=e=>re(R(p)))},{default:C((()=>t[18]||(t[18]=[L("提交")]))),_:1,__:[18]})])])),default:C((()=>[x(se,{ref_key:"formRef",ref:p,model:R(X),rules:R(Q),"label-width":"120px"},{default:C((()=>[x(v,{label:"角色名称",prop:"roleName"},{default:C((()=>[x(n,{modelValue:R(X).roleName,"onUpdate:modelValue":t[3]||(t[3]=e=>R(X).roleName=e)},null,8,["modelValue"])])),_:1}),x(v,{label:"角色编码",prop:"roleCode"},{default:C((()=>[x(n,{modelValue:R(X).roleCode,"onUpdate:modelValue":t[4]||(t[4]=e=>R(X).roleCode=e)},null,8,["modelValue"])])),_:1}),x(v,{label:"描述",prop:"roleStatus"},{default:C((()=>[x(n,{modelValue:R(X).des,"onUpdate:modelValue":t[5]||(t[5]=e=>R(X).des=e),type:"textarea",rows:3},null,8,["modelValue"])])),_:1}),x(v,{label:"启用"},{default:C((()=>[x(ee,{modelValue:R(X).enable,"onUpdate:modelValue":t[6]||(t[6]=e=>R(X).enable=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]),x(ie,{modelValue:R(l),"onUpdate:modelValue":t[10]||(t[10]=e=>A(l)?l.value=e:null),title:"菜单权限",width:"520px","align-center":"",class:"el-dialog-border"},{footer:C((()=>[w("div",H,[x(u,{onClick:de},{default:C((()=>[L(K(R(o)?"全部收起":"全部展开"),1)])),_:1}),x(u,{onClick:ne,style:{"margin-left":"8px"}},{default:C((()=>[L(K(R(d)?"取消全选":"全部选择"),1)])),_:1}),x(u,{type:"primary",onClick:oe},{default:C((()=>t[19]||(t[19]=[L("保存")]))),_:1,__:[19]})])])),default:C((()=>[x(me,{height:"70vh"},{default:C((()=>[x(ce,{ref_key:"treeRef",ref:r,data:R(i),"show-checkbox":"","node-key":"name","default-expand-all":R(o),"default-checked-keys":[1,2,3],props:te,onCheck:ue},{default:C((({data:e})=>[w("div",M,[e.isAuth?(k(),y("span",W,K(e.label),1)):(k(),y("span",Z,K(te.label(e)),1))])])),_:1},8,["data","default-expand-all"])])),_:1})])),_:1},8,["modelValue"])])}}})))),[["__scopeId","data-v-e22d3c0b"]]);export{X as default};
