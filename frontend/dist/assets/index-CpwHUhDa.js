var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,s=(a,l,r)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[l]=r,n=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&s(e,l,a[l]);if(r)for(var l of r(a))t.call(a,l)&&s(e,l,a[l]);return e},i=(e,r)=>a(e,l(r)),p=(e,a,l)=>new Promise(((r,o)=>{var t=e=>{try{n(l.next(e))}catch(a){o(a)}},s=e=>{try{n(l.throw(e))}catch(a){o(a)}},n=e=>e.done?r(e.value):Promise.resolve(e.value).then(t,s);n((l=l.apply(e,a)).next())}));import{_ as u}from"./ArtTableFullScreen-Bpx86egv.js";import{U as d,f as c,_ as m}from"./index-Co7Jc6td.js";/* empty css                */import{_ as f}from"./ArtTable-DOVWYSlp.js";/* empty css                        *//* empty css                    */import{_ as g}from"./ArtTableHeader-Jt3SPBqc.js";import{u as v,_ as b}from"./useCheckedColumns-BJfyBYT9.js";import{A as h,R as y}from"./formData-DjnVdGbe.js";import{A as _}from"./ArtButtonTable--khuujwm.js";import{k as j,r as k,a2 as w,e as P,S as U,t as x,y as C,z as V,x as N,i as S,u as R,a$ as T,P as A,T as O,m as z,I as E,J as I,aN as D,b0 as q,a6 as G,a3 as L,a4 as B,L as F,ad as H,ae as J,E as W,_ as $,aw as K}from"./vendor-CJD3O2Jl.js";/* empty css                   *//* empty css                      *//* empty css                 */import"./formEnum-BLgiZVxV.js";import"./vue-draggable-plus-g6z8A2Qb.js";/* empty css               *//* empty css               *//* empty css                       *//* empty css                 *//* empty css                       */const M={class:"account-page",id:"table-full-screen"},X={class:"dialog-footer"},Q=m(j(i(n({},{name:"User"}),{__name:"index",setup(e){const a=k("add"),l=k(!1),r=k(!1),o={name:"",phone:"",email:"",date:"",daterange:""},t=k([]),s=w(n({},o)),m=w({currentPage:1,pageSize:20,total:0}),j=k([]),Q=k(),Y=k([]),Z=k(null),ee=()=>{Object.assign(s,n({},o)),m.currentPage=1,de()},ae=()=>{m.currentPage=1,de()},le=e=>{},re=[{label:"用户名",prop:"name",type:"input",config:{clearable:!0},onChange:le},{label:"电话",prop:"phone",type:"input",config:{clearable:!0},onChange:le},{label:"邮箱",prop:"email",type:"input",config:{clearable:!0},onChange:le},{prop:"date",label:"日期",type:"date",config:{type:"date",placeholder:"请选择日期"}},{prop:"daterange",label:"日期范围",type:"daterange",config:{type:"daterange",startPlaceholder:"开始时间",endPlaceholder:"结束时间"}}],oe=[{label:"用户名",prop:"name"},{label:"手机号",prop:"phone"},{label:"性别",prop:"gender"},{label:"角色",prop:"role"},{label:"账号",prop:"username"},{label:"创建日期",prop:"createTime"},{label:"操作",prop:"operation"}],te=(e,r)=>{var o,t;l.value=!0,a.value=e,pe.value&&pe.value.resetFields(),ue.username="",ue.password="",ue.role="",ue.profile={realName:"",nickname:"",email:"",phone:"",school:"",sex:"",description:"",avatar:"",backgroundUrl:""},"edit"===e&&r&&(Z.value=r.userId,ue.username=r.username,ue.role=(null==(o=r.userRoles)?void 0:o[0])||r.role,ue.profile.realName=(null==(t=r.profile)?void 0:t.realName)||r.name,ue.password="")},se=e=>p(this,null,(function*(){try{yield K.confirm("确定要注销该用户吗？","注销用户",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),r.value=!0;const a=yield d.deleteUser(e);a.code===c.success?(W.success("注销成功"),yield de()):W.error(a.message||"注销失败")}catch(a){"cancel"!==a&&W.error("注销失败，请重试")}finally{r.value=!1}})),{columnChecks:ne,columns:ie}=v((()=>[{prop:"avatar",label:"用户信息",minWidth:220,formatter:e=>$("div",{class:"user",style:"display: flex; align-items: center"},[$("img",{class:"avatar",src:e.avatar}),$("div",{},[$("p",{class:"user-name"},[$("span",{},e.name),$("span",{class:"user-role"},`（${{R_SUPER:"超级管理员",R_ADMIN:"管理员",R_USER:"普通用户"}[e.role]||e.role}）`)]),$("p",{class:"email"},e.userEmail)])])},{prop:"userGender",label:"性别",sortable:!0,formatter:e=>"1"===e.userGender?"男":"女"},{prop:"userPhone",label:"手机号"},{prop:"username",label:"账号",formatter:e=>e.username},{prop:"createTime",label:"创建日期",sortable:!0},{prop:"operation",label:"操作",width:150,formatter:e=>$("div",[$(_,{type:"edit",onClick:()=>te("edit",e)}),$(_,{type:"delete",onClick:()=>se(e.userId)})])}])),pe=k(),ue=w({username:"",password:"",role:"",profile:{realName:"",nickname:"",email:"",phone:"",school:"",sex:"",description:"",avatar:"",backgroundUrl:""}});P((()=>{de(),ce()}));const de=()=>p(this,null,(function*(){r.value=!0;try{const e={current:m.currentPage,size:m.pageSize};s.name&&(e.keyword=s.name),s.phone&&(e.phone=s.phone),s.email&&(e.email=s.email),s.date&&(e.date=s.date),s.daterange&&2===s.daterange.length&&(e.startDate=s.daterange[0],e.endDate=s.daterange[1]);const a=yield d.getUserList(e);if(a.code===c.success){const e=a.data.map(((e,a)=>{var l,r,o,t,s,p,u,d,c;const m=a%h.length;return i(n({},e),{avatar:(null==(l=e.profile)?void 0:l.avatar)||h[m].avatar,name:(null==(r=e.profile)?void 0:r.realName)||e.username,userEmail:null==(o=e.profile)?void 0:o.email,userPhone:null==(t=e.profile)?void 0:t.phone,userGender:null==(s=e.profile)?void 0:s.sex,nickname:null==(p=e.profile)?void 0:p.nickname,school:null==(u=e.profile)?void 0:u.school,description:null==(d=e.profile)?void 0:d.description,createTime:e.createdAt,backgroundUrl:null==(c=e.profile)?void 0:c.backgroundUrl})}));j.value=e,m.total=a.data.length,r.value=!1}}catch(e){r.value=!1}})),ce=()=>{t.value=y},me=()=>{de()},fe=e=>{Y.value=e},ge=w({username:[{required:!0,message:"请输入账号",trigger:"blur"},{min:4,max:20,message:"长度在 4 到 20 个字符",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],"profile.realName":[{required:!0,message:"请输入真实姓名",trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}]}),ve=()=>p(this,null,(function*(){pe.value&&(yield pe.value.validate((e=>p(this,null,(function*(){if(e)try{r.value=!0;const e={username:ue.username,password:ue.password,role:Array.isArray(ue.role)?ue.role[0]:ue.role,profile:{realName:ue.profile.realName,nickname:ue.profile.nickname,email:ue.profile.email,phone:ue.profile.phone,school:ue.profile.school,sex:ue.profile.sex,description:ue.profile.description,avatar:ue.profile.avatar,backgroundUrl:ue.profile.backgroundUrl}};if("add"===a.value){const a=yield d.addUser(e);a.code===c.success?(W.success("添加用户成功"),l.value=!1,de()):W.error(a.message||"添加用户失败")}else if("edit"===a.value&&Z.value){const a=yield d.updateUserInfo(Z.value,e);a.code===c.success?(W.success("更新用户成功"),l.value=!1,de()):W.error(a.message||"更新用户失败")}}catch(o){W.error("操作失败，请重试")}finally{r.value=!1}})))))})),be=e=>{m.pageSize=e,de()},he=e=>{m.currentPage=e,de()};return(e,o)=>{const n=b,i=A,p=g,d=D,c=f,v=F,h=B,y=J,_=H,k=L,w=T,P=u;return x(),U(P,null,{default:C((()=>[V("div",M,[N(n,{filter:R(s),"onUpdate:filter":o[0]||(o[0]=e=>S(s)?s.value=e:null),items:re,onReset:ee,onSearch:ae},null,8,["filter"]),N(w,{shadow:"never",class:"art-table-card"},{default:C((()=>[N(p,{columnList:oe,columns:R(ne),"onUpdate:columns":o[2]||(o[2]=e=>S(ne)?ne.value=e:null),onRefresh:me},{left:C((()=>[N(i,{onClick:o[1]||(o[1]=e=>te("add"))},{default:C((()=>o[9]||(o[9]=[O("新增用户")]))),_:1,__:[9]})])),_:1},8,["columns"]),N(c,{ref_key:"tableRef",ref:Q,"row-key":"id",loading:R(r),data:R(j),currentPage:R(m).currentPage,pageSize:R(m).pageSize,total:R(m).total,marginTop:10,onSelectionChange:fe,onSizeChange:be,onCurrentChange:he},{default:C((()=>[(x(!0),z(E,null,I(R(ie),(e=>(x(),U(d,q({key:e.prop||e.type},{ref_for:!0},e),null,16)))),128))])),_:1},8,["loading","data","currentPage","pageSize","total"]),N(R(G),{modelValue:R(l),"onUpdate:modelValue":o[8]||(o[8]=e=>S(l)?l.value=e:null),title:"add"===R(a)?"添加用户":"编辑用户",width:"30%","align-center":""},{footer:C((()=>[V("div",X,[N(i,{onClick:o[7]||(o[7]=e=>l.value=!1)},{default:C((()=>o[10]||(o[10]=[O("取消")]))),_:1,__:[10]}),N(i,{type:"primary",onClick:ve},{default:C((()=>o[11]||(o[11]=[O("提交")]))),_:1,__:[11]})])])),default:C((()=>[N(k,{ref_key:"formRef",ref:pe,model:R(ue),rules:R(ge),"label-width":"80px"},{default:C((()=>[N(h,{label:"账号",prop:"username"},{default:C((()=>[N(v,{modelValue:R(ue).username,"onUpdate:modelValue":o[3]||(o[3]=e=>R(ue).username=e),placeholder:"请输入账号"},null,8,["modelValue"])])),_:1}),N(h,{label:"密码",prop:"password"},{default:C((()=>[N(v,{modelValue:R(ue).password,"onUpdate:modelValue":o[4]||(o[4]=e=>R(ue).password=e),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])])),_:1}),N(h,{label:"真实姓名",prop:"profile.realName"},{default:C((()=>[N(v,{modelValue:R(ue).profile.realName,"onUpdate:modelValue":o[5]||(o[5]=e=>R(ue).profile.realName=e),placeholder:"请输入真实姓名"},null,8,["modelValue"])])),_:1}),N(h,{label:"角色",prop:"role"},{default:C((()=>[N(_,{modelValue:R(ue).role,"onUpdate:modelValue":o[6]||(o[6]=e=>R(ue).role=e),placeholder:"请选择角色"},{default:C((()=>[(x(!0),z(E,null,I(R(t),(e=>(x(),U(y,{key:e.roleCode,value:e.roleCode,label:e.roleName},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])])),_:1})])])),_:1})}}})),[["__scopeId","data-v-5ef55493"]]);export{Q as default};
