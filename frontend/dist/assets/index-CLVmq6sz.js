var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,d=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&r(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&r(e,l,a[l]);return e},u=(e,a,l)=>new Promise(((t,o)=>{var s=e=>{try{d(l.next(e))}catch(a){o(a)}},r=e=>{try{d(l.throw(e))}catch(a){o(a)}},d=e=>e.done?t(e.value):Promise.resolve(e.value).then(s,r);d((l=l.apply(e,a)).next())}));import{b as i,_ as n}from"./index-D1Hg0Vwf.js";/* empty css                   *//* empty css                       *//* empty css                      *//* empty css                        *//* empty css                    *//* empty css               *//* empty css               */import{k as c,r as p,a2 as v,e as b,m,t as f,x as w,O as g,z as y,y as _,aI as h,L as D,M as k,u as j,a8 as x,ad as V,I,J as Y,ae as O,aJ as S,aH as T,S as C,aN as P,aZ as M,T as U,G as z,a_ as B,aS as A,P as E,a6 as J,a3 as L,a4 as R,aY as G,E as N}from"./vendor-CJD3O2Jl.js";import{B as q}from"./bookApi-eQapcbwQ.js";import{B as F}from"./borrowApi-nU-wAjg-.js";import{A as H}from"./ArtButtonTable-Bc-gga8r.js";const K={class:"page-content book-list"},Q={class:"custom-segmented"},Z={style:{display:"flex","justify-content":"center","margin-top":"20px"}},W={class:"book-detail"},X={class:"detail-row"},$={class:"detail-value"},ee={class:"detail-row"},ae={class:"detail-value"},le={class:"detail-row"},te={class:"detail-value"},oe={class:"detail-row"},se={class:"detail-value"},re={class:"detail-row"},de={class:"detail-value"},ue={class:"detail-row"},ie={class:"detail-value"},ne={class:"detail-row"},ce={class:"detail-value"},pe={class:"detail-row"},ve={class:"detail-value"},be={class:"detail-row"},me={class:"cover-container"},fe=["src"],we={key:1},ge={class:"dialog-footer"},ye={class:"dialog-footer"};var _e;const he=n(c((_e=d({},{name:"BookList"}),a(_e,l({__name:"index",setup(e){const a=["文学","科技","历史","艺术","经济","教育","其他"],l=p(""),t=p(""),o=p(1),s=p(10),r=p(0),n=p(!1),c=p([]),_e=i(),he=p(!1),De=p({}),ke=()=>u(this,null,(function*(){n.value=!0;try{const e={current:o.value,size:s.value,title:l.value,category:t.value},a=yield q.getBookList(e);200===a.code&&(c.value=a.data.records,r.value=a.data.total)}catch(e){}finally{n.value=!1}})),je=()=>{o.value=1,ke()},xe=e=>{s.value=e,ke()},Ve=e=>{o.value=e,ke()},Ie=p(!1),Ye=p(),Oe=v({bookId:0,bookTitle:"",userId:_e.info.userId,borrowDate:(new Date).toISOString().split("T")[0],dueDate:""}),Se={borrowDate:[{required:!0,message:"请选择借阅日期",trigger:"change"}],dueDate:[{validator:(e,a,l)=>{a?new Date(a)<=new Date(Oe.borrowDate)?l(new Error("归还日期必须晚于借阅日期")):l():l(new Error("请选择归还日期"))},trigger:"change"}]},Te=()=>u(this,null,(function*(){Ye.value&&(yield Ye.value.validate((e=>u(this,null,(function*(){var a,l;if(e)try{const e={bookId:{bookId:Oe.bookId},user:{userId:Oe.userId},borrowDate:Oe.borrowDate,dueDate:Oe.dueDate},a=yield F.createBorrowRecord(e);200===a.code?(N.success("借阅成功"),Ie.value=!1,ke()):N.error(a.message||"借阅失败")}catch(t){const e=(null==(l=null==(a=t.response)?void 0:a.data)?void 0:l.message)||t.message||"借阅失败，请重试";N.error(e)}})))))}));return b((()=>{ke()})),(e,u)=>{const i=D,p=h,v=O,b=V,N=S,q=P,F=M,_e=B,ke=A,Ce=E,Pe=J,Me=R,Ue=G,ze=L,Be=T;return f(),m("div",K,[w(N,{justify:"space-between",gutter:10},{default:_((()=>[w(p,{lg:6,md:6,sm:14,xs:16},{default:_((()=>[w(i,{modelValue:l.value,"onUpdate:modelValue":u[0]||(u[0]=e=>l.value=e),"prefix-icon":j(x),clearable:"",placeholder:"输入书名或作者查询",onKeyup:k(je,["enter"])},null,8,["modelValue","prefix-icon"])])),_:1}),w(p,{lg:12,md:12,sm:0,xs:0},{default:_((()=>[y("div",Q,[w(b,{modelValue:t.value,"onUpdate:modelValue":u[1]||(u[1]=e=>t.value=e),placeholder:"选择分类",clearable:"",onChange:je},{default:_((()=>[(f(),m(I,null,Y(a,(e=>w(v,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])])),_:1})])),_:1}),g((f(),C(_e,{data:c.value,style:{width:"100%","margin-top":"20px"}},{default:_((()=>[w(q,{prop:"title",label:"书名","min-width":"180"}),w(q,{prop:"author",label:"作者",width:"120"}),w(q,{prop:"publisher",label:"出版社",width:"180"}),w(q,{prop:"category",label:"分类",width:"100"}),w(q,{prop:"status",label:"状态",width:"100"},{default:_((e=>[w(F,{type:1===e.row.status?"success":"danger"},{default:_((()=>[U(z(1===e.row.status?"可借阅":"已借出"),1)])),_:2},1032,["type"])])),_:1}),w(q,{prop:"createTime",label:"创建时间",width:"180"}),w(q,{label:"详情",width:"80"},{default:_((e=>[w(H,{type:"eye",onClick:a=>{return l=e.row,De.value=d({},l),void(he.value=!0);var l}},null,8,["onClick"])])),_:1}),w(q,{fixed:"right",label:"操作",width:"150"},{default:_((e=>[1===e.row.status?(f(),C(H,{key:0,style:{color:"#329ff5","background-color":"#eef3ff","border-color":"#fff"},type:"success",disabled:1!==e.row.status,onClick:a=>(e=>{Oe.bookId=e.bookId,Oe.bookTitle=e.title,Oe.borrowDate=(new Date).toISOString().split("T")[0];const a=new Date;a.setDate(a.getDate()+30),Oe.dueDate=a.toISOString().split("T")[0],Ie.value=!0})(e.row),text:"借阅"},{default:_((()=>u[11]||(u[11]=[U(" 借阅 ")]))),_:2,__:[11]},1032,["disabled","onClick"])):(f(),C(F,{key:1,type:"info"},{default:_((()=>u[12]||(u[12]=[U("已借出")]))),_:1,__:[12]}))])),_:1})])),_:1},8,["data"])),[[Be,n.value]]),y("div",Z,[w(ke,{"current-page":o.value,"onUpdate:currentPage":u[2]||(u[2]=e=>o.value=e),"page-size":s.value,"onUpdate:pageSize":u[3]||(u[3]=e=>s.value=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:r.value,onSizeChange:xe,onCurrentChange:Ve},null,8,["current-page","page-size","total"])]),w(Pe,{title:"图书详情",modelValue:he.value,"onUpdate:modelValue":u[5]||(u[5]=e=>he.value=e),width:"600px"},{default:_((()=>[y("div",W,[y("div",X,[u[13]||(u[13]=y("span",{class:"detail-label"},"书名:",-1)),y("span",$,z(De.value.title),1)]),y("div",ee,[u[14]||(u[14]=y("span",{class:"detail-label"},"作者:",-1)),y("span",ae,z(De.value.author),1)]),y("div",le,[u[15]||(u[15]=y("span",{class:"detail-label"},"出版社:",-1)),y("span",te,z(De.value.publisher),1)]),y("div",oe,[u[16]||(u[16]=y("span",{class:"detail-label"},"ISBN:",-1)),y("span",se,z(De.value.isbn),1)]),y("div",re,[u[17]||(u[17]=y("span",{class:"detail-label"},"分类:",-1)),y("span",de,z(De.value.category),1)]),y("div",ue,[u[18]||(u[18]=y("span",{class:"detail-label"},"状态:",-1)),y("span",ie,[w(F,{type:1===De.value.status?"success":"danger"},{default:_((()=>[U(z(1===De.value.status?"可借阅":"已借出"),1)])),_:1},8,["type"])])]),y("div",ne,[u[19]||(u[19]=y("span",{class:"detail-label"},"创建时间:",-1)),y("span",ce,z(De.value.createTime),1)]),y("div",pe,[u[20]||(u[20]=y("span",{class:"detail-label"},"描述:",-1)),y("span",ve,z(De.value.description||"无"),1)]),y("div",be,[u[21]||(u[21]=y("span",{class:"detail-label"},"封面:",-1)),y("div",me,[De.value.cover?(f(),m("img",{key:0,src:De.value.cover,class:"detail-cover",alt:"封面"},null,8,fe)):(f(),m("span",we,"无封面图片"))])])]),y("div",ge,[w(Ce,{onClick:u[4]||(u[4]=e=>he.value=!1)},{default:_((()=>u[22]||(u[22]=[U("关闭")]))),_:1,__:[22]})])])),_:1},8,["modelValue"]),w(Pe,{title:"图书借阅",modelValue:Ie.value,"onUpdate:modelValue":u[10]||(u[10]=e=>Ie.value=e),width:"400px"},{default:_((()=>[w(ze,{ref_key:"borrowFormRef",ref:Ye,model:Oe,rules:Se,"label-width":"100px"},{default:_((()=>[w(Me,{label:"图书名称",prop:"bookTitle"},{default:_((()=>[w(i,{modelValue:Oe.bookTitle,"onUpdate:modelValue":u[6]||(u[6]=e=>Oe.bookTitle=e),disabled:""},null,8,["modelValue"])])),_:1}),w(Me,{label:"借阅日期",prop:"borrowDate"},{default:_((()=>[w(Ue,{modelValue:Oe.borrowDate,"onUpdate:modelValue":u[7]||(u[7]=e=>Oe.borrowDate=e),type:"date",placeholder:"选择借阅日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD","disabled-date":e=>e<new Date},null,8,["modelValue","disabled-date"])])),_:1}),w(Me,{label:"归还日期",prop:"dueDate"},{default:_((()=>[w(Ue,{modelValue:Oe.dueDate,"onUpdate:modelValue":u[8]||(u[8]=e=>Oe.dueDate=e),type:"date",placeholder:"选择归还日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1})])),_:1},8,["model"]),y("div",ye,[w(Ce,{onClick:u[9]||(u[9]=e=>Ie.value=!1)},{default:_((()=>u[23]||(u[23]=[U("取消")]))),_:1,__:[23]}),w(Ce,{type:"primary",onClick:Te},{default:_((()=>u[24]||(u[24]=[U("确认借阅")]))),_:1,__:[24]})])])),_:1},8,["modelValue"])])}}})))),[["__scopeId","data-v-4ea87338"]]);export{he as default};
