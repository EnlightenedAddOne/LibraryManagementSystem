var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,r=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,u=(l,a,r)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:r}):l[a]=r,s=(e,l,a)=>new Promise(((r,o)=>{var t=e=>{try{s(a.next(e))}catch(l){o(l)}},u=e=>{try{s(a.throw(e))}catch(l){o(l)}},s=e=>e.done?r(e.value):Promise.resolve(e.value).then(t,u);s((a=a.apply(e,l)).next())}));import{_ as d}from"./index-D1Hg0Vwf.js";/* empty css                  *//* empty css                    *//* empty css                       */import{k as p,l as c,r as i,m as n,t as v,z as m,x as b,y as f,a4 as g,L as h,ad as y,I as V,J as _,ae as j,aY as k,aW as x,H as P,u as U,aX as w,P as D,T as O,a3 as Y,E as q}from"./vendor-CJD3O2Jl.js";import{B}from"./bookApi-eQapcbwQ.js";const I={class:"page-content add-book"},M={class:"form-container"},N={class:"left-form"},S={class:"right-form"},C={class:"upload-container"},z=["src"],E={key:1,class:"upload-placeholder"},G={class:"form-buttons"},J=d(p({__name:"index",setup(e){const d=c(),p=i(),J=["文学","科技","历史","艺术","经济","教育","其他"],L=i({title:"",author:"",publisher:"",isbn:"",category:"",publishDate:"",description:"",cover:"",status:0}),R=()=>{L.value.cover&&(L.value.cover="")},A=e=>{200===e.code?(L.value.cover=e.data.url,L.value.cover="",q.success("封面上传成功")):q.error("封面上传失败")},F=()=>s(this,null,(function*(){p.value&&(yield p.value.validate((e=>s(this,null,(function*(){if(e)try{const e=(s=((e,l)=>{for(var a in l||(l={}))o.call(l,a)&&u(e,a,l[a]);if(r)for(var a of r(l))t.call(l,a)&&u(e,a,l[a]);return e})({},L.value),d={cover:L.value.cover||L.value.cover},l(s,a(d)));delete e.cover;const p=yield B.addBook(e);200===p.code?(q.success("添加成功"),T()):q.error(p.message||"添加失败")}catch(p){q.error("添加失败，请重试")}var s,d})))))})),H=e=>{const l="image/jpeg"===e.type||"image/png"===e.type,a=e.size/1024/1024<2;return l||q.error("封面图片只能是 JPG 或 PNG 格式!"),a||q.error("封面图片大小不能超过 2MB!"),l&&a},Q={title:[{required:!0,message:"请输入书名",trigger:"blur"}],author:[{required:!0,message:"请输入作者",trigger:"blur"}],publisher:[{required:!0,message:"请输入出版社",trigger:"blur"}],isbn:[{required:!0,message:"请输入ISBN",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]},T=()=>{d.back()};return(e,l)=>{const a=h,r=g,o=j,t=y,u=k,s=P,d=x,c=D,i=Y;return v(),n("div",I,[l[13]||(l[13]=m("h2",{class:"page-title"},"添加图书",-1)),b(i,{ref_key:"formRef",ref:p,model:L.value,rules:Q,"label-width":"120px",class:"book-form"},{default:f((()=>[m("div",M,[m("div",N,[b(r,{label:"书名",prop:"title"},{default:f((()=>[b(a,{modelValue:L.value.title,"onUpdate:modelValue":l[0]||(l[0]=e=>L.value.title=e),placeholder:"请输入书名"},null,8,["modelValue"])])),_:1}),b(r,{label:"作者",prop:"author"},{default:f((()=>[b(a,{modelValue:L.value.author,"onUpdate:modelValue":l[1]||(l[1]=e=>L.value.author=e),placeholder:"请输入作者"},null,8,["modelValue"])])),_:1}),b(r,{label:"出版社",prop:"publisher"},{default:f((()=>[b(a,{modelValue:L.value.publisher,"onUpdate:modelValue":l[2]||(l[2]=e=>L.value.publisher=e),placeholder:"请输入出版社"},null,8,["modelValue"])])),_:1}),b(r,{label:"ISBN",prop:"isbn"},{default:f((()=>[b(a,{modelValue:L.value.isbn,"onUpdate:modelValue":l[3]||(l[3]=e=>L.value.isbn=e),placeholder:"请输入ISBN"},null,8,["modelValue"])])),_:1}),b(r,{label:"分类",prop:"category"},{default:f((()=>[b(t,{modelValue:L.value.category,"onUpdate:modelValue":l[4]||(l[4]=e=>L.value.category=e),placeholder:"请选择分类"},{default:f((()=>[(v(),n(V,null,_(J,(e=>b(o,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),b(r,{label:"出版日期",prop:"publishDate"},{default:f((()=>[b(u,{modelValue:L.value.publishDate,"onUpdate:modelValue":l[5]||(l[5]=e=>L.value.publishDate=e),type:"date",placeholder:"选择出版日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])])),_:1}),b(r,{label:"状态",prop:"status"},{default:f((()=>[b(t,{modelValue:L.value.status,"onUpdate:modelValue":l[6]||(l[6]=e=>L.value.status=e),placeholder:"请选择状态"},{default:f((()=>[b(o,{value:0,label:"可借阅"}),b(o,{value:1,label:"已借出"})])),_:1},8,["modelValue"])])),_:1})]),m("div",S,[b(r,{label:"图书封面",prop:"cover"},{default:f((()=>[m("div",C,[b(d,{class:"cover-uploader",action:"/api/upload","show-file-list":!1,"on-success":A,"before-upload":H},{default:f((()=>[L.value.cover||L.value.cover?(v(),n("img",{key:0,src:L.value.cover||L.value.cover,class:"cover"},null,8,z)):(v(),n("div",E,[b(s,null,{default:f((()=>[b(U(w))])),_:1}),l[9]||(l[9]=m("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),l[10]||(l[10]=m("div",{class:"upload-tip"},"建议尺寸: 300x400px, 支持 jpg/png 格式",-1)),b(a,{modelValue:L.value.cover,"onUpdate:modelValue":l[7]||(l[7]=e=>L.value.cover=e),placeholder:"或输入图片URL",style:{"margin-top":"10px"},onChange:R},null,8,["modelValue"])])])),_:1}),b(r,{label:"图书描述",prop:"description"},{default:f((()=>[b(a,{modelValue:L.value.description,"onUpdate:modelValue":l[8]||(l[8]=e=>L.value.description=e),type:"textarea",rows:4,placeholder:"请输入图书描述"},null,8,["modelValue"])])),_:1})])]),m("div",G,[b(c,{onClick:T},{default:f((()=>l[11]||(l[11]=[O("取消")]))),_:1,__:[11]}),b(c,{type:"primary",onClick:F},{default:f((()=>l[12]||(l[12]=[O("保存")]))),_:1,__:[12]})])])),_:1},8,["model"])])}}}),[["__scopeId","data-v-a002d2c2"]]);export{J as default};
