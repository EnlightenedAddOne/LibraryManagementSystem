var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,o=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,i=(e,a,l)=>new Promise(((t,s)=>{var r=e=>{try{i(l.next(e))}catch(a){s(a)}},o=e=>{try{i(l.throw(e))}catch(a){s(a)}},i=e=>e.done?t(e.value):Promise.resolve(e.value).then(r,o);i((l=l.apply(e,a)).next())}));import{j as u,b as c,r as n,y as d,v as p,f as m,x as v,E as f,_ as y}from"./index-Co7Jc6td.js";/* empty css                  *//* empty css                    */import{_ as h}from"./ArtWangEditor.vue_vue_type_style_index_0_lang-DiS48zFn.js";/* empty css               *//* empty css               */import{k as _,al as g,l as b,r as j,e as w,m as x,t as V,z as A,x as O,y as P,aI as $,L as E,i as k,u as T,ad as z,I as D,J as I,S as M,ae as U,aJ as Y,a4 as q,aW as L,H as N,aX as W,ab as J,a3 as S,T as B,G as C,P as F,E as G}from"./vendor-CJD3O2Jl.js";import{P as H}from"./formEnum-BLgiZVxV.js";class X{static getArticleList(e){const{page:a,size:l,searchVal:t,year:s}=e;return u.get({url:`/api/articles/${a}/${l}?title=${t}&year=${s}`})}static getArticleTypes(e){return u.get({url:"/api/articles/types",params:e})}static getArticleDetail(e){return u.get({url:`/api/articles/${e}`})}static addArticle(e){return u.post({url:"/api/articles/",data:e})}static editArticle(e,a){return u.put({url:`/api/articles/${e}`,data:a})}}const K={class:"article-edit"},Q={class:"editor-wrap"},R={class:"form-wrap"},Z={class:"el-top upload-container"},ee={key:0,class:"upload-placeholder"},ae=["src"],le={style:{display:"flex","justify-content":"flex-end"}},te=_((se=((e,a)=>{for(var l in a||(a={}))s.call(a,l)&&o(e,l,a[l]);if(t)for(var l of t(a))r.call(a,l)&&o(e,l,a[l]);return e})({},{name:"ArticlePublish"}),a(se,l({__name:"index",setup(e){const a=g(),l=b(),t=c();let{accessToken:s}=t;const r={Authorization:s};let o=H.Add;const u=j(""),y=j(),_=j(),te=j(""),se=j(""),re=j(""),oe=j(!0);w((()=>{n().scrollToTop(),ne(),ie()}));const ie=()=>{const{id:e}=a.query;o=e?H.Edit:H.Add,o===H.Edit&&e?ue(Number(e)):ce()},ue=e=>{de=e,pe()},ce=()=>{se.value=ve(d().value)},ne=()=>i(this,null,(function*(){try{const e=yield p.get("https://www.qiniu.lingchen.kim/classify.json");200===e.data.code&&(_.value=e.data.data)}catch(e){}}));let de=0;const pe=()=>i(this,null,(function*(){const e=yield p.get("https://www.qiniu.lingchen.kim/blog_list.json");if(e.data.code===m.success){let{title:a,blog_class:l,html_content:t}=e.data.data;u.value=a,y.value=Number(l),te.value=t}})),me=()=>{o===H.Edit?_e():he()},ve=e=>v(e,"YYYY-MM-DD").value,fe=()=>u.value?y.value?"<p><br></p>"===te.value?(G.error("请输入文章内容"),!1):!!re.value||(G.error("请上传图片"),!1):(G.error("请选择文章类型"),!1):(G.error("请输入文章标题"),!1),ye=()=>({title:u.value,html_content:te.value,home_img:re.value,blog_class:y.value,create_time:se.value}),he=()=>i(this,null,(function*(){try{if(!fe())return;te.value=ge(te.value);const e=ye();(yield X.addArticle(e)).code===m.success&&(G.success(`发布成功 ${f[200]}`),we())}catch(e){}})),_e=()=>i(this,null,(function*(){try{if(!fe())return;te.value=ge(te.value);const e=ye();(yield X.editArticle(de,e)).code===m.success&&(G.success(`修改成功 ${f[200]}`),we())}catch(e){}})),ge=e=>e.replace(/(\s*)<\/code>/g,"</code>"),be=e=>{re.value=e.data.url,G.success(`图片上传成功 ${f[200]}`)},je=()=>{G.error(`图片上传失败 ${f[500]}`)},we=()=>{setTimeout((()=>{l.go(-1)}),800)},xe=e=>{const a=e.type.startsWith("image/"),l=e.size/1024/1024<2;return a?!!l||(G.error("图片大小不能超过 2MB!"),!1):(G.error("只能上传图片文件!"),!1)};return(e,a)=>{const l=E,t=$,s=U,i=z,c=Y,n=h,d=N,p=L,m=q,v=J,f=S,g=F;return V(),x("div",K,[A("div",null,[A("div",Q,[O(c,{gutter:10},{default:P((()=>[O(t,{span:18},{default:P((()=>[O(l,{modelValue:T(u),"onUpdate:modelValue":a[0]||(a[0]=e=>k(u)?u.value=e:null),modelModifiers:{trim:!0},placeholder:"请输入文章标题（最多100个字符）",maxlength:"100"},null,8,["modelValue"])])),_:1}),O(t,{span:6},{default:P((()=>[O(i,{modelValue:T(y),"onUpdate:modelValue":a[1]||(a[1]=e=>k(y)?y.value=e:null),placeholder:"请选择文章类型",filterable:""},{default:P((()=>[(V(!0),x(D,null,I(T(_),(e=>(V(),M(s,{key:e.id,label:e.name,value:e.id},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),O(n,{class:"el-top",modelValue:T(te),"onUpdate:modelValue":a[2]||(a[2]=e=>k(te)?te.value=e:null)},null,8,["modelValue"]),A("div",R,[a[6]||(a[6]=A("h2",null,"发布设置",-1)),O(f,null,{default:P((()=>[O(m,{label:"封面"},{default:P((()=>[A("div",Z,[O(p,{class:"cover-uploader",action:"http://43.139.87.6:8080/api/api/common/upload",headers:r,"show-file-list":!1,"on-success":be,"on-error":je,"before-upload":xe},{default:P((()=>[T(re)?(V(),x("img",{key:1,src:T(re),class:"cover-image"},null,8,ae)):(V(),x("div",ee,[O(d,{class:"upload-icon"},{default:P((()=>[O(T(W))])),_:1}),a[4]||(a[4]=A("div",{class:"upload-text"},"点击上传封面",-1))]))])),_:1}),a[5]||(a[5]=A("div",{class:"el-upload__tip"},"建议尺寸 16:9，jpg/png 格式",-1))])])),_:1}),O(m,{label:"可见"},{default:P((()=>[O(v,{modelValue:T(oe),"onUpdate:modelValue":a[3]||(a[3]=e=>k(oe)?oe.value=e:null)},null,8,["modelValue"])])),_:1})])),_:1}),A("div",le,[O(g,{type:"primary",onClick:me,style:{width:"100px"}},{default:P((()=>[B(C(T(o)===T(H).Edit?"保存":"发布"),1)])),_:1})])])])])])}}}))));var se;const re=y(te,[["__scopeId","data-v-efac46a3"]]);export{re as default};
