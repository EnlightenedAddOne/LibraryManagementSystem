var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,u=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&u(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&u(e,l,a[l]);return e},d=(e,t)=>a(e,l(t)),i=(e,a,l)=>new Promise(((t,s)=>{var o=e=>{try{r(l.next(e))}catch(a){s(a)}},u=e=>{try{r(l.throw(e))}catch(a){s(a)}},r=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,u);r((l=l.apply(e,a)).next())}));import{_ as n}from"./index-Co7Jc6td.js";/* empty css                   *//* empty css                  *//* empty css                    *//* empty css                      *//* empty css                        *//* empty css                    *//* empty css               *//* empty css               */import{k as c,r as p,e as v,m,t as b,x as f,O as y,z as g,y as h,aI as _,L as w,M as V,u as k,a8 as x,ad as j,I as C,J as U,ae as B,P as I,T as O,aJ as P,aH as S,S as z,aN as N,aZ as q,G as L,a_ as T,aS as A,a6 as J,a3 as R,a4 as E,aW as G,H,aX as D,E as F,aw as K}from"./vendor-CJD3O2Jl.js";import{B as M}from"./bookApi-CHNSDh28.js";import{A as Q}from"./ArtButtonTable--khuujwm.js";const W={class:"page-content book-list"},X={class:"custom-segmented"},Z={style:{display:"flex","justify-content":"center","margin-top":"20px"}},$={class:"book-detail"},Y={class:"detail-row"},ee={class:"detail-value"},ae={class:"detail-row"},le={class:"detail-value"},te={class:"detail-row"},se={class:"detail-value"},oe={class:"detail-row"},ue={class:"detail-value"},re={class:"detail-row"},de={class:"detail-value"},ie={class:"detail-row"},ne={class:"detail-value"},ce={class:"detail-row"},pe={class:"detail-value"},ve={class:"detail-row"},me={class:"detail-value"},be={class:"detail-row"},fe={class:"cover-container"},ye=["src"],ge={key:1},he={class:"dialog-footer"},_e=["src"],we={class:"dialog-footer"},Ve=n(c(d(r({},{name:"BookList"}),{__name:"index",setup(e){const a=["文学","科技","历史","艺术","经济","教育","其他"],l=p(""),t=p(""),s=p(1),o=p(10),u=p(0),n=p(!1),c=p([]),Ve=p(!1),ke=p(!1),xe=p("add"),je=p(),Ce=p({}),Ue=e=>{200===e.code?Ce.value.cover=e.data.url:F.error("上传失败")},Be=()=>i(this,null,(function*(){je.value&&(yield je.value.validate((e=>i(this,null,(function*(){if(e)try{const e=r({},Ce.value);if("add"===xe.value){200===(yield M.addBook(e)).code&&(F.success("添加成功"),Ie())}else{200===(yield M.updateBook(Ce.value.bookId,e)).code&&(F.success("更新成功"),Ie())}Ve.value=!1}catch(a){}})))))})),Ie=()=>i(this,null,(function*(){n.value=!0;try{const e={current:s.value,size:o.value,title:l.value,category:t.value},a=yield M.getBookList(e);200===a.code&&(c.value=a.data.records,u.value=a.data.total)}catch(e){}finally{n.value=!1}})),Oe=()=>{s.value=1,Ie()},Pe=e=>{o.value=e,Ie()},Se=e=>{s.value=e,Ie()},ze=()=>{xe.value="add",Ce.value={},Ve.value=!0},Ne=p({title:[{required:!0,message:"请输入书名",trigger:"blur"}],author:[{required:!0,message:"请输入作者",trigger:"blur"}],publisher:[{required:!0,message:"请输入出版社",trigger:"blur"}],isbn:[{required:!0,message:"请输入ISBN",trigger:"blur"},{pattern:/^[0-9-]{10,17}$/,message:"ISBN格式不正确",trigger:"blur"}],category:[{required:!0,message:"请选择分类",trigger:"change"}]}),qe=e=>i(this,null,(function*(){try{yield K.confirm("确认删除该图书吗？","提示",{type:"warning"});200===(yield M.deleteBook(e.bookId)).code&&(F.success("删除成功"),Ie())}catch(a){}}));return v((()=>{Ie()})),(e,i)=>{const p=w,v=_,F=B,K=j,M=I,Ie=P,Le=N,Te=q,Ae=T,Je=A,Re=J,Ee=E,Ge=H,He=G,De=R,Fe=S;return b(),m("div",W,[f(Ie,{justify:"space-between",gutter:10},{default:h((()=>[f(v,{lg:6,md:6,sm:14,xs:16},{default:h((()=>[f(p,{modelValue:l.value,"onUpdate:modelValue":i[0]||(i[0]=e=>l.value=e),"prefix-icon":k(x),clearable:"",placeholder:"输入书名或作者查询",onKeyup:V(Oe,["enter"])},null,8,["modelValue","prefix-icon"])])),_:1}),f(v,{lg:12,md:12,sm:0,xs:0},{default:h((()=>[g("div",X,[f(K,{modelValue:t.value,"onUpdate:modelValue":i[1]||(i[1]=e=>t.value=e),placeholder:"选择分类",clearable:"",onChange:Oe},{default:h((()=>[(b(),m(C,null,U(a,(e=>f(F,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])])),_:1}),f(v,{lg:6,md:6,sm:10,xs:6,style:{display:"flex","justify-content":"end"}},{default:h((()=>[f(M,{type:"primary",onClick:ze},{default:h((()=>i[15]||(i[15]=[O("添加图书")]))),_:1,__:[15]})])),_:1})])),_:1}),y((b(),z(Ae,{data:c.value,style:{width:"100%","margin-top":"20px"}},{default:h((()=>[f(Le,{prop:"title",label:"书名","min-width":"180"}),f(Le,{prop:"author",label:"作者",width:"120"}),f(Le,{prop:"publisher",label:"出版社",width:"180"}),f(Le,{prop:"category",label:"分类",width:"100"}),f(Le,{prop:"status",label:"状态",width:"100"},{default:h((e=>[f(Te,{type:1===e.row.status?"success":"danger"},{default:h((()=>[O(L(1===e.row.status?"可借阅":"已借出"),1)])),_:2},1032,["type"])])),_:1}),f(Le,{prop:"createTime",label:"创建时间",width:"180"}),f(Le,{label:"详情",width:"80"},{default:h((e=>[f(Q,{type:"eye",onClick:a=>{return l=e.row,Ce.value=r({},l),void(ke.value=!0);var l}},null,8,["onClick"])])),_:1}),f(Le,{fixed:"right",label:"操作",width:"150"},{default:h((e=>[f(Q,{type:"edit",onClick:a=>{return l=e.row,xe.value="edit",Ce.value=d(r({},l),{cover:l.cover||""}),void(Ve.value=!0);var l}},null,8,["onClick"]),f(Q,{type:"delete",onClick:a=>qe(e.row)},null,8,["onClick"])])),_:1})])),_:1},8,["data"])),[[Fe,n.value]]),g("div",Z,[f(Je,{"current-page":s.value,"onUpdate:currentPage":i[2]||(i[2]=e=>s.value=e),"page-size":o.value,"onUpdate:pageSize":i[3]||(i[3]=e=>o.value=e),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:u.value,onSizeChange:Pe,onCurrentChange:Se},null,8,["current-page","page-size","total"])]),f(Re,{title:"图书详情",modelValue:ke.value,"onUpdate:modelValue":i[5]||(i[5]=e=>ke.value=e),width:"600px"},{default:h((()=>[g("div",$,[g("div",Y,[i[16]||(i[16]=g("span",{class:"detail-label"},"书名:",-1)),g("span",ee,L(Ce.value.title),1)]),g("div",ae,[i[17]||(i[17]=g("span",{class:"detail-label"},"作者:",-1)),g("span",le,L(Ce.value.author),1)]),g("div",te,[i[18]||(i[18]=g("span",{class:"detail-label"},"出版社:",-1)),g("span",se,L(Ce.value.publisher),1)]),g("div",oe,[i[19]||(i[19]=g("span",{class:"detail-label"},"ISBN:",-1)),g("span",ue,L(Ce.value.isbn),1)]),g("div",re,[i[20]||(i[20]=g("span",{class:"detail-label"},"分类:",-1)),g("span",de,L(Ce.value.category),1)]),g("div",ie,[i[21]||(i[21]=g("span",{class:"detail-label"},"状态:",-1)),g("span",ne,[f(Te,{type:1===Ce.value.status?"success":"danger"},{default:h((()=>[O(L(1===Ce.value.status?"可借阅":"已借出"),1)])),_:1},8,["type"])])]),g("div",ce,[i[22]||(i[22]=g("span",{class:"detail-label"},"创建时间:",-1)),g("span",pe,L(Ce.value.createTime),1)]),g("div",ve,[i[23]||(i[23]=g("span",{class:"detail-label"},"描述:",-1)),g("span",me,L(Ce.value.description||"无"),1)]),g("div",be,[i[24]||(i[24]=g("span",{class:"detail-label"},"封面:",-1)),g("div",fe,[Ce.value.cover||Ce.value.cover?(b(),m("img",{key:0,src:Ce.value.cover||Ce.value.cover,class:"detail-cover",alt:"封面"},null,8,ye)):(b(),m("span",ge,"无封面图片"))])])]),g("div",he,[f(M,{onClick:i[4]||(i[4]=e=>ke.value=!1)},{default:h((()=>i[25]||(i[25]=[O("关闭")]))),_:1,__:[25]})])])),_:1},8,["modelValue"]),f(Re,{title:"add"===xe.value?"添加图书":"编辑图书",modelValue:Ve.value,"onUpdate:modelValue":i[14]||(i[14]=e=>Ve.value=e),width:"500px"},{default:h((()=>[f(De,{ref_key:"formRef",ref:je,model:Ce.value,rules:Ne.value,"label-width":"100px",style:{"max-height":"60vh","overflow-y":"auto"}},{default:h((()=>[f(Ee,{label:"书名",prop:"title"},{default:h((()=>[f(p,{modelValue:Ce.value.title,"onUpdate:modelValue":i[6]||(i[6]=e=>Ce.value.title=e)},null,8,["modelValue"])])),_:1}),f(Ee,{label:"作者",prop:"author"},{default:h((()=>[f(p,{modelValue:Ce.value.author,"onUpdate:modelValue":i[7]||(i[7]=e=>Ce.value.author=e)},null,8,["modelValue"])])),_:1}),f(Ee,{label:"出版社",prop:"publisher"},{default:h((()=>[f(p,{modelValue:Ce.value.publisher,"onUpdate:modelValue":i[8]||(i[8]=e=>Ce.value.publisher=e)},null,8,["modelValue"])])),_:1}),f(Ee,{label:"ISBN",prop:"isbn"},{default:h((()=>[f(p,{modelValue:Ce.value.isbn,"onUpdate:modelValue":i[9]||(i[9]=e=>Ce.value.isbn=e)},null,8,["modelValue"])])),_:1}),f(Ee,{label:"分类",prop:"category"},{default:h((()=>[f(K,{modelValue:Ce.value.category,"onUpdate:modelValue":i[10]||(i[10]=e=>Ce.value.category=e),placeholder:"选择分类"},{default:h((()=>[(b(),m(C,null,U(a,(e=>f(F,{key:e,label:e,value:e},null,8,["label","value"]))),64))])),_:1},8,["modelValue"])])),_:1}),f(Ee,{label:"描述",prop:"description"},{default:h((()=>[f(p,{modelValue:Ce.value.description,"onUpdate:modelValue":i[11]||(i[11]=e=>Ce.value.description=e),type:"textarea",rows:3},null,8,["modelValue"])])),_:1}),f(Ee,{label:"封面",prop:"cover"},{default:h((()=>[f(He,{class:"avatar-uploader","show-file-list":!1,"on-success":Ue},{default:h((()=>[Ce.value.cover||Ce.value.cover?(b(),m("img",{key:0,src:Ce.value.cover||Ce.value.cover,class:"avatar",alt:"封面"},null,8,_e)):(b(),z(Ge,{key:1,class:"avatar-uploader-icon"},{default:h((()=>[f(k(D))])),_:1}))])),_:1}),f(p,{modelValue:Ce.value.cover,"onUpdate:modelValue":i[12]||(i[12]=e=>Ce.value.cover=e),placeholder:"或输入图片URL",style:{"margin-top":"10px"}},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"]),g("div",we,[f(M,{onClick:i[13]||(i[13]=e=>Ve.value=!1)},{default:h((()=>i[26]||(i[26]=[O("取消")]))),_:1,__:[26]}),f(M,{type:"primary",onClick:Be},{default:h((()=>i[27]||(i[27]=[O("确定")]))),_:1,__:[27]})])])),_:1},8,["title","modelValue"])])}}})),[["__scopeId","data-v-e0149f8c"]]);export{Ve as default};
